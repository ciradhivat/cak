<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pfäk IDE Editor (Ace Edition)</title>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 3. Google Fonts: JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- 4. JS Beautify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.min.js"></script>

    <!-- 5. Ace Editor (Main + Tools + Emmet support if needed) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ext-language_tools.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ext-searchbox.min.js"></script>
    
    <style>
        /* Base Styles */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        
        body { overscroll-behavior-y: none; }

        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        #main-nav { transition: transform 0.3s ease-in-out; will-change: transform; }
        .nav-hidden { transform: translateY(-100%); }
        .fab-transition { transition: transform 0.2s, background-color 0.3s; }
        .fab-hidden { transform: scale(0); }
        .hidden-force { display: none !important; }

        /* Typography */
        :root {
            --editor-font-family: 'JetBrains Mono', monospace; 
        }

        /* Editor Layout */
        #editor-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #editor { 
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            font-family: var(--editor-font-family) !important;
        }

        /* Ace Customization to match theme */
        .ace_editor { font-family: 'JetBrains Mono', monospace !important; }
        .ace_gutter { background: #1f2937 !important; color: #6b7280 !important; }
        .ace_print-margin { display: none !important; }
        .ace_search { background-color: #374151 !important; color: white !important; border: 1px solid #4b5563 !important; }
        .ace_search_field { background-color: #1f2937 !important; color: white !important; }

        /* Console Log Styles */
        .log-entry { font-family: 'JetBrains Mono', monospace; font-size: 12px; border-bottom: 1px solid #374151; padding: 4px 8px; }
        .log-info { color: #d1d5db; }
        .log-warn { color: #fcd34d; background-color: #422006; }
        .log-error { color: #fca5a5; background-color: #450a0a; }

        /* Simple Toast */
        #toast-msg {
            position: fixed; 
            top: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px); 
            color: white; 
            border-radius: 12px;
            padding: 12px 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); 
            z-index: 100;
            border: 1px solid #444;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-[100dvh] w-full flex flex-col overflow-hidden font-sans supports-[height:100dvh]:h-[100dvh] supports-[not(height:100dvh)]:h-screen">

    <!-- Header -->
    <nav id="main-nav" class="flex items-center justify-between px-4 py-3 bg-gray-800 border-b border-gray-700 shadow-md z-20 shrink-0 h-16 w-full absolute top-0 left-0">
        <div class="flex items-center gap-3">
            <button onclick="toggleSidebar()" class="p-2 rounded hover:bg-gray-700 active:bg-gray-600 focus:outline-none transition">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <h1 class="text-lg font-bold truncate max-w-[150px]" id="doc-title">เอกสารใหม่.html</h1>
        </div>
        <div class="flex items-center gap-2">
            <div class="text-xs text-gray-400 hidden sm:block" id="line-count-display">0 บรรทัด</div>
        </div>
    </nav>

    <div class="h-16 shrink-0"></div>

    <!-- Main Editor Area (Modified for ACE) -->
    <div class="flex flex-1 relative overflow-hidden" id="editor-wrapper">
        <div id="editor"></div>
    </div>

    <!-- FAB -->
    <button id="fab-mode" onclick="toggleReadMode()" class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 rounded-full shadow-lg flex items-center justify-center text-white z-30 fab-transition hover:scale-110 active:scale-95 border-2 border-gray-700">
        <i class="fas fa-eye text-xl"></i>
    </button>
    <div id="mode-toast" class="fixed bottom-24 right-6 bg-black bg-opacity-80 text-white text-xs px-3 py-1 rounded opacity-0 transition-opacity z-30 pointer-events-none">โหมดอ่าน</div>

    <!-- Sidebar -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden backdrop-blur-sm transition-opacity"></div>
    <div id="sidebar" class="fixed top-0 left-0 w-72 h-full bg-gray-800 shadow-2xl z-50 transform -translate-x-full sidebar-transition flex flex-col border-r border-gray-700">
        <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900">
            <h2 class="font-bold text-xl text-white">เมนูหลัก</h2>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto p-2 space-y-2">
            
            <!-- View Settings -->
            <div class="bg-gray-700 rounded-lg p-2 mb-2">
                <div class="text-xs text-gray-400 mb-2 font-bold uppercase">ขนาดตัวอักษร</div>
                <div class="flex items-center justify-between bg-gray-800 rounded p-1">
                    <button onclick="adjustFontSize(-1)" class="w-10 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 rounded text-white active:bg-gray-500"><i class="fas fa-minus text-xs"></i></button>
                    <span id="font-size-label" class="text-sm font-mono text-yellow-300">14px</span>
                    <button onclick="adjustFontSize(1)" class="w-10 h-8 flex items-center justify-center bg-gray-700 hover:bg-gray-600 rounded text-white active:bg-gray-500"><i class="fas fa-plus text-xs"></i></button>
                </div>
            </div>

            <div class="bg-gray-700 rounded-lg p-2 mb-2">
                <div class="text-xs text-gray-400 mb-2 font-bold uppercase">เครื่องมือโค้ด</div>
                <button onclick="runLocalPreview()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-cyan-300 text-left mb-1">
                    <i class="fas fa-play w-6 text-center"></i> <span>รัน / ดูผลลัพธ์ (Local)</span>
                </button>
                <button onclick="formatCode()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-pink-300 text-left mb-1">
                    <i class="fas fa-magic w-6 text-center"></i> <span>จัดรูปแบบอัตโนมัติ</span>
                </button>
                <button onclick="openInBrowser()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-purple-300 text-left">
                    <i class="fas fa-external-link-alt w-6 text-center"></i> <span>เปิด Tab ใหม่</span>
                </button>
            </div>

            <div class="bg-gray-700 rounded-lg p-2 mb-2">
                <div class="text-xs text-gray-400 mb-2 font-bold uppercase">การแสดงผล</div>
                <button onclick="toggleLineNumbersExplicit()" id="btn-line-nums" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-blue-300 text-left mb-1">
                    <i class="fas fa-list-ol w-6 text-center"></i> <span id="label-line-nums">เลขบรรทัด: แสดง</span>
                </button>
                <button onclick="toggleSoftWrap()" id="btn-wrap" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-gray-300 text-left">
                    <i class="fas fa-align-left w-6 text-center"></i> <span id="label-wrap">ตัดคำอัตโนมัติ: ปิด</span>
                </button>
            </div>
            
            <div class="bg-gray-700 rounded-lg p-2 mb-2">
                <div class="text-xs text-gray-400 mb-2 font-bold uppercase">การนำทาง</div>
                <button onclick="scrollToTop()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-yellow-300 text-left mb-1">
                    <i class="fas fa-arrow-up w-6 text-center"></i> <span>ไปบรรทัดแรก</span>
                </button>
                <button onclick="scrollToBottom()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-yellow-300 text-left">
                    <i class="fas fa-arrow-down w-6 text-center"></i> <span>ไปบรรทัดสุดท้าย</span>
                </button>
            </div>
            
            <div class="bg-gray-700 rounded-lg p-2">
                <div class="text-xs text-gray-400 mb-2 font-bold uppercase">จัดการไฟล์</div>
                <button onclick="newFile()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-white text-left mb-1">
                    <i class="fas fa-file w-6 text-center"></i> <span>สร้างไฟล์ใหม่</span>
                </button>
                <label class="flex items-center gap-3 p-2 rounded hover:bg-gray-600 cursor-pointer text-blue-300 mb-1">
                    <i class="fas fa-file-import w-6 text-center"></i> <span>นำเข้าไฟล์</span>
                    <input type="file" id="file-input" accept=".txt,.html,.css,.js" class="hidden" onchange="loadFile(this)">
                </label>
                <button onclick="saveFile()" class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-600 text-green-300 text-left">
                    <i class="fas fa-save w-6 text-center"></i> <span>บันทึกไฟล์ (Save)</span>
                </button>
            </div>
            
            <div class="p-3 text-gray-400 text-sm">
                <div class="mb-2 font-bold text-gray-300">ข้อมูลไฟล์</div>
                <div id="stat-lines">บรรทัด: 0</div>
                <div id="stat-chars">ตัวอักษร: 0</div>
                <div id="stat-mode" class="mt-2 text-blue-400 font-bold transition-colors duration-300">สถานะ: แก้ไขได้</div>
            </div>
        </div>
        <div class="p-4 border-t border-gray-700 text-xs text-gray-500 text-center bg-gray-900">Text Master Mobile v18.0 Ace</div>
    </div>

    <!-- PREVIEW OVERLAY -->
    <div id="preview-overlay" class="fixed inset-0 bg-gray-900 z-50 flex flex-col hidden">
        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700 shrink-0">
            <h2 class="text-white font-bold flex items-center gap-2 text-sm sm:text-base">
                <i class="fas fa-globe-asia text-cyan-400"></i> Local Preview
            </h2>
            <div class="flex gap-2">
                <button onclick="toggleConsole()" id="btn-toggle-console" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-white text-xs flex items-center gap-1 border border-gray-600">
                    <i class="fas fa-terminal"></i> <span id="txt-toggle-console" class="hidden sm:inline">ซ่อน Log</span>
                </button>
                <button onclick="runLocalPreview()" class="px-3 py-1 bg-green-700 hover:bg-green-600 rounded text-white text-xs"><i class="fas fa-sync-alt"></i></button>
                <button onclick="closePreview()" class="px-3 py-1 bg-red-700 hover:bg-red-600 rounded text-white text-xs"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="flex-1 bg-white relative">
            <iframe id="preview-frame" class="w-full h-full border-none"></iframe>
        </div>
        <div class="flex flex-col bg-gray-900 border-t border-gray-700 h-1/3 shrink-0" id="console-container">
            <div class="flex items-center justify-between px-2 py-1 bg-gray-800 border-b border-gray-700">
                <div class="text-xs text-gray-400 font-bold uppercase flex items-center gap-2">
                    <i class="fas fa-terminal"></i> Console / Logs <span id="log-count" class="bg-gray-700 text-white px-1 rounded-full text-[10px]">0</span>
                </div>
                <button onclick="clearConsole()" class="text-gray-400 hover:text-white text-xs"><i class="fas fa-trash-alt"></i> ล้าง</button>
            </div>
            <div id="console-logs" class="flex-1 overflow-y-auto p-2 font-mono text-xs text-gray-300 space-y-1">
                <div class="text-gray-500 italic text-center mt-4">ไม่มี Log (พร้อมทำงาน)</div>
            </div>
        </div>
    </div>

    <!-- Simple Toast -->
    <div id="toast-msg" class="opacity-0"></div>

    <script>
        // --- ACE EDITOR INITIALIZATION ---
        // Setup Ace Editor
        var aceEditor = ace.edit("editor");
        aceEditor.setTheme("ace/theme/dracula");
        aceEditor.session.setMode("ace/mode/html");
        
        // Editor Options for Mobile/Performance
        aceEditor.setOptions({
            fontSize: "14px",
            fontFamily: "JetBrains Mono",
            showPrintMargin: false,
            showGutter: true,
            highlightActiveLine: true,
            wrap: false, // Default no wrap
            useSoftTabs: true,
            tabSize: 4,
            displayIndentGuides: true,
            scrollPastEnd: 0.5, // Allow scrolling past end
        });

        // Set Default Value
        aceEditor.setValue(`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Ace</title>
    <style>
        body { background: #111; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
        h1 { color: #4ade80; }
    </style>
</head>
<body>
    <h1>Hello World!</h1>
</body>
</html>`, -1); // -1 moves cursor to start

        // --- Core Variables ---
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const modeToast = document.getElementById('mode-toast');
        const fabBtn = document.getElementById('fab-mode');
        const fabIcon = fabBtn.querySelector('i');
        const btnLineNums = document.getElementById('btn-line-nums');
        const labelLineNums = document.getElementById('label-line-nums');
        const btnWrap = document.getElementById('btn-wrap');
        const labelWrap = document.getElementById('label-wrap');
        const fontSizeLabel = document.getElementById('font-size-label');
        const statMode = document.getElementById('stat-mode');
        const docTitle = document.getElementById('doc-title');
        const toastEl = document.getElementById('toast-msg');

        // --- Preview Variables ---
        const previewOverlay = document.getElementById('preview-overlay');
        const previewFrame = document.getElementById('preview-frame');
        const consoleContainer = document.getElementById('console-container');
        const consoleLogs = document.getElementById('console-logs');
        const btnToggleConsole = document.getElementById('btn-toggle-console');
        const txtToggleConsole = document.getElementById('txt-toggle-console');
        let isConsoleVisible = true;
        let logCount = 0;

        let currentFileName = "index.html";
        let isReadOnly = false;
        let isLineNumsVisible = true;
        let isSoftWrap = false;
        let currentFontSize = 14;

        // --- HELPER: Show Toast ---
        function showToast(msg) {
            toastEl.innerText = msg;
            toastEl.classList.remove('opacity-0');
            setTimeout(() => toastEl.classList.add('opacity-0'), 2500);
        }

        // --- PREVIEW & CONSOLE FUNCTIONS ---
        function runLocalPreview() { 
            previewOverlay.classList.remove('hidden'); 
            toggleSidebar(); 
            document.getElementById('console-logs').innerHTML='<div class="text-gray-500 italic text-center mt-4">ไม่มี Log (พร้อมทำงาน)</div>'; 
            document.getElementById('log-count').innerText='0'; 
            logCount=0; 
            
            const c = aceEditor.getValue(); // Get content from Ace
            const i=`<script>(function(){function s(t,a){try{window.parent.postMessage({s:'pc',t:t,m:a.map(x=>(typeof x=='object'?JSON.stringify(x):String(x))).join(' ')},'*')}catch(e){}}const ol=console.log,ow=console.warn,oe=console.error;console.log=(...a)=>{s('i',a);ol.apply(console,a)};console.warn=(...a)=>{s('w',a);ow.apply(console,a)};console.error=(...a)=>{s('e',a);oe.apply(console,a)};window.onerror=(m,u,l,c,e)=>{s('e',[\`Uncaught: \${m} (Line:\${l})\`]);return false;};})();<\/script>`; 
            let h=c.includes('<head>')?c.replace('<head>','<head>'+i):i+c; 
            previewFrame.src=URL.createObjectURL(new Blob([h],{type:'text/html'})); 
        }

        window.addEventListener('message', e=>{if(e.data&&e.data.s==='pc')addLogEntry(e.data.t==='i'?'info':(e.data.t==='w'?'warn':'error'),e.data.m);});
        function addLogEntry(t,m) { if(logCount===0)document.getElementById('console-logs').innerHTML=''; logCount++; document.getElementById('log-count').innerText=logCount; const d=document.createElement('div'); d.className=`log-entry log-${t}`; const tm=new Date().toLocaleTimeString('th-TH',{hour12:false}); const ic=t==='error'?'<i class="fas fa-times-circle mr-1"></i>':(t==='warn'?'<i class="fas fa-exclamation-triangle mr-1"></i>':'<i class="fas fa-info-circle mr-1"></i>'); d.innerHTML=`<span class="opacity-50 mr-2">[${tm}]</span>${ic} ${m.replace(/</g,'&lt;')}`; document.getElementById('console-logs').appendChild(d); document.getElementById('console-logs').scrollTop=document.getElementById('console-logs').scrollHeight; }
        function closePreview() { previewOverlay.classList.add('hidden'); previewFrame.src=""; }
        function toggleConsole() { isConsoleVisible=!isConsoleVisible; if(isConsoleVisible){consoleContainer.classList.remove('hidden');btnToggleConsole.classList.replace('bg-gray-500','bg-gray-700');txtToggleConsole.innerText="ซ่อน Log";}else{consoleContainer.classList.add('hidden');btnToggleConsole.classList.replace('bg-gray-700','bg-gray-500');txtToggleConsole.innerText="แสดง Log";} }
        function clearConsole() { document.getElementById('console-logs').innerHTML='<div class="text-gray-500 italic text-center mt-4">ไม่มี Log (พร้อมทำงาน)</div>'; logCount=0; document.getElementById('log-count').innerText='0'; }

        // --- UI FUNCTIONS ---
        // Stats Listener with Ace
        aceEditor.session.on('change', updateStats);
        
        function toggleSidebar() { sidebar.classList.toggle('-translate-x-full'); overlay.classList.toggle('hidden'); fabBtn.classList.toggle('fab-hidden', !sidebar.classList.contains('-translate-x-full')); }
        
        function openInBrowser() { 
            window.open(URL.createObjectURL(new Blob([aceEditor.getValue()], {type:'text/html'})), '_blank'); 
            toggleSidebar(); 
        }
        
        function newFile() { 
            if(aceEditor.getValue().trim() && !confirm("ข้อมูลหาย?")) return; 
            aceEditor.setValue(""); 
            docTitle.innerText = "เอกสารใหม่.html";
            toggleSidebar(); 
        }

        function toggleReadMode() { 
            isReadOnly = !isReadOnly; 
            aceEditor.setReadOnly(isReadOnly);
            // Visual Updates
            fabIcon.className = isReadOnly ? "fas fa-pen" : "fas fa-eye"; 
            fabBtn.classList.toggle('bg-blue-600'); 
            fabBtn.classList.toggle('bg-gray-600'); 
            modeToast.innerText = isReadOnly ? "โหมดอ่าน" : "โหมดแก้ไข"; 
            modeToast.classList.remove('opacity-0'); 
            setTimeout(()=>modeToast.classList.add('opacity-0'),2000); 
            
            if(isReadOnly){
                statMode.innerText="สถานะ: อ่านอย่างเดียว";
                statMode.className="mt-2 text-gray-400 font-bold transition-colors duration-300";
                aceEditor.renderer.setStyle("disabled", true);
            } else {
                statMode.innerText="สถานะ: แก้ไขได้";
                statMode.className="mt-2 text-blue-400 font-bold transition-colors duration-300";
                aceEditor.renderer.setStyle("disabled", false);
            }
            if(!isReadOnly) aceEditor.focus();
        }

        function updateStats() { 
            const val = aceEditor.getValue();
            const lines = aceEditor.session.getLength();
            document.getElementById('stat-lines').innerText = `บรรทัด: ${lines}`; 
            document.getElementById('line-count-display').innerText = `${lines} บรรทัด`; 
            document.getElementById('stat-chars').innerText = `ตัวอักษร: ${val.length}`; 
        }

        function saveFile() { 
            const a=document.createElement('a'); 
            a.href=URL.createObjectURL(new Blob([aceEditor.getValue()],{type:'text/plain'})); 
            a.download=currentFileName; 
            document.body.appendChild(a); a.click(); document.body.removeChild(a); 
            toggleSidebar(); 
        }

        function loadFile(i) { 
            const f=i.files[0]; 
            if(!f)return; 
            const r=new FileReader(); 
            r.onload=e=>{
                aceEditor.setValue(e.target.result, -1);
                currentFileName = f.name;
                docTitle.innerText = f.name;
                
                // Auto Detect Mode (Simple)
                if(f.name.endsWith('.js')) aceEditor.session.setMode("ace/mode/javascript");
                else if(f.name.endsWith('.css')) aceEditor.session.setMode("ace/mode/css");
                else aceEditor.session.setMode("ace/mode/html");
                
                updateStats(); 
            }; 
            r.readAsText(f); 
            toggleSidebar(); 
            i.value=''; 
        }

        // --- Editor Settings Logic Mapping ---
        function toggleLineNumbersExplicit() { 
            isLineNumsVisible = !isLineNumsVisible; 
            aceEditor.renderer.setShowGutter(isLineNumsVisible);
            
            btnLineNums.classList.toggle('text-blue-300'); 
            labelLineNums.innerText = isLineNumsVisible ? "เลขบรรทัด: แสดง" : "เลขบรรทัด: ซ่อน";
            toggleSidebar(); 
        }
        
        function toggleSoftWrap() { 
            isSoftWrap = !isSoftWrap; 
            aceEditor.session.setUseWrapMode(isSoftWrap);
            
            btnWrap.classList.toggle('text-blue-300'); 
            labelWrap.innerText = isSoftWrap ? "ตัดคำอัตโนมัติ: เปิด" : "ตัดคำอัตโนมัติ: ปิด";
            toggleSidebar(); 
        }

        function adjustFontSize(d) { 
            let n = currentFontSize + d; 
            if(n>=10 && n<=32){
                currentFontSize = n; 
                aceEditor.setFontSize(n + "px");
                document.getElementById('font-size-label').innerText=`${n}px`;
            } 
        }

        function formatCode() { 
            if(isReadOnly)return; 
            const o={indent_size:4}; 
            let c = aceEditor.getValue(); 
            // Detect based on content
            if(c.includes('<html') || c.trim().startsWith('<!DOCTYPE')) c = html_beautify(c,o); 
            else if(c.includes('{') && !c.includes('<')) c = css_beautify(c,o); // Rough guess
            else if(c.includes('function') || c.includes('const ')) c = js_beautify(c,o);
            else c = html_beautify(c,o); // Fallback

            aceEditor.setValue(c, -1);
            toggleSidebar(); 
        }

        function scrollToTop() { aceEditor.scrollToLine(0, true, true, function(){}); toggleSidebar(); }
        function scrollToBottom() { aceEditor.scrollToLine(aceEditor.session.getLength(), true, true, function(){}); toggleSidebar(); }

        // Init
        updateStats();

    </script>
</body>
</html>
