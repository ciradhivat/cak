<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thai-Latin Notepad OS</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f3f4f6">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600&family=Noto+Sans+Mono:wght@400;600&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #bf360c;
            --bg: #fafafa;
            --surface: #ffffff;
            --border: #e0e0e0;
            --key-bg: #ffffff;
            --key-shadow: #888888;
            --key-active: #ffccbc;
            --kb-height: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Sarabun', 'Noto Sans', sans-serif;
            background-color: var(--bg);
            color: #333;
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            width: 100%;
            height: 100%;
            max-width: 800px;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            position: relative;
        }

        @media (min-width: 601px) {
            .container {
                height: 95vh;
                margin-top: 2.5vh;
                border-radius: 16px;
                overflow: hidden;
                border: 1px solid #ddd;
            }
        }

        .header {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            flex-shrink: 0;
            height: 55px;
        }

        .header-left { display: flex; gap: 8px; align-items: center; }

        .fs-btn {
            background: none;
            border: 1px solid #ddd;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #555;
            flex-shrink: 0;
            font-weight: bold;
        }
        .fs-btn:hover { background-color: #f5f5f5; }

        .controls {
            display: flex;
            background-color: #f0f0f0;
            border-radius: 20px;
            padding: 3px;
        }

        .radio-group {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: 18px;
            transition: all 0.2s;
            color: #666;
            font-weight: 600;
        }
        .radio-group input { display: none; }
        .radio-group:has(input:checked) {
            background-color: #fff;
            color: var(--primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .options-bar {
            padding: 5px 10px;
            display: flex;
            justify-content: flex-end;
            background: #fafafa;
            border-bottom: 1px solid #eee;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: #666;
            cursor: pointer;
        }

        .content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            overflow-y: auto;
        }

        .input-wrapper {
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 80px;
        }

        textarea {
            width: 100%;
            height: 100%;
            padding: 15px;
            padding-right: 40px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1.2rem;
            font-family: 'Noto Sans Mono', 'Sarabun', sans-serif; 
            resize: none;
            background: #fff;
            -webkit-user-select: text;
            user-select: text;
        }
        textarea:focus { outline: none; border-color: var(--primary); }

        .system-kb-toggle {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: #eee;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            color: #555;
            z-index: 10;
            font-weight: 600;
        }
        .system-kb-toggle.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }

        .clear-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border: none;
            background: rgba(0,0,0,0.05);
            color: #888;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            z-index: 10;
        }

        .result-wrapper {
            flex: 1;
            background: #fff8e1;
            border-radius: 8px;
            border: 1px solid #ffe0b2;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            min-height: 80px;
            -webkit-user-select: text;
            user-select: text;
        }

        .result-label {
            font-size: 0.75rem;
            color: #a1887f;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .result-text {
            font-family: 'Noto Sans Mono', 'Noto Sans', monospace;
            font-size: 1.25rem;
            color: var(--primary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: anywhere; 
        }

        /* Keyboard */
        .kb-toggle-btn {
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .kb-toggle-btn.active { color: #fff; background: var(--primary); }

        .keyboard-container {
            background: #d1d5db;
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: 0;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }
        .keyboard-container.show { height: var(--kb-height); }

        .kb-tabs {
            display: flex;
            background: #e5e7eb;
            padding: 4px 4px 0 4px;
            gap: 4px;
            height: 40px;
        }

        .kb-tab-btn {
            flex: 1;
            border: none;
            background: #d1d5db;
            color: #555;
            font-weight: 600;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.1s;
        }
        .kb-tab-btn.active {
            background: #f3f4f6;
            color: var(--primary);
            box-shadow: 0 -1px 2px rgba(0,0,0,0.05);
        }

        .kb-pages {
            flex: 1;
            background: #f3f4f6;
            padding: 6px;
            position: relative;
        }

        .kb-page {
            display: none;
            grid-template-rows: repeat(4, 1fr);
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            height: 100%;
        }
        .kb-page.active { display: grid; }

        .key-btn {
            border: none;
            background: var(--key-bg);
            border-radius: 5px;
            font-family: 'Noto Sans Mono', sans-serif;
            font-size: 1.1rem;
            color: #000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 0 var(--key-shadow);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .key-btn:active { background: var(--key-active); transform: translateY(1px); box-shadow: none; }

        .key-spacer { grid-column: span 1; visibility: hidden; }
        .key-space { grid-column: span 5; }
        .key-action { grid-column: span 2; background: #b0bec5; font-size: 0.9rem; }
        .key-enter { background: #4fc3f7; color: #000; }
        .key-sep { background: #ffe0b2; color: #e65100; font-weight: bold; font-size: 0.8rem; }
        
        .key-tone { color: var(--primary); font-weight: bold; position: relative; }
        .key-tone span { color: #ccc; position: absolute; z-index: 0; font-size: 0.8em; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .key-tone b { z-index: 1; position: relative; }
        
        .key-num { font-weight: bold; color: #1565c0; }
        .key-sym { color: #424242; }

        /* Help Modal */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0; top: 0;
            width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.6); 
            backdrop-filter: blur(2px);
            align-items: center; justify-content: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background-color: #fff; width: 90%; max-width: 600px; max-height: 85%;
            padding: 25px; border-radius: 12px; position: relative; overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: modalPop 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes modalPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .close-modal { position: absolute; top: 15px; right: 20px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; background: none; border: none; }
        .manual-content h2 { color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .manual-content h3 { color: #555; margin-top: 20px; margin-bottom: 10px; }
        .key-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        .key-table th, .key-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .key-table th { background-color: #f5f5f5; }
        .key-badge { display: inline-block; padding: 2px 6px; background: #eee; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; font-weight: bold; font-size: 0.9em; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="header-left">
                <button id="fullscreenBtn" class="fs-btn" title="เต็มจอ">⛶</button>
                <button id="helpBtn" class="fs-btn" title="คู่มือ">?</button>
                <div class="controls">
                    <label class="radio-group">
                        <input type="radio" name="mode" value="toLatin" checked>
                        <span>ไทย⮕Lat</span>
                    </label>
                    <label class="radio-group">
                        <input type="radio" name="mode" value="toThai">
                        <span>Lat⮕ไทย</span>
                    </label>
                </div>
            </div>
            <button id="toggleKbBtn" class="kb-toggle-btn active" title="Toggle Keyboard">⌨️</button>
        </div>

        <div class="options-bar">
            <label class="checkbox-group">
                <input type="checkbox" id="showSep" checked>
                <span>แสดงจุดคั่น (·)</span>
            </label>
        </div>

        <div class="content-area">
            <div class="input-wrapper">
                <textarea id="input" inputmode="none" placeholder="พิมพ์ข้อความ..."></textarea>
                <button id="clearBtn" class="clear-btn">✕</button>
                <button id="systemKbToggle" class="system-kb-toggle" title="ใช้แป้นพิมพ์เครื่อง">Sys KB: OFF</button>
            </div>

            <div class="result-wrapper">
                <div class="result-label" id="resultLabel">Result (Latin)</div>
                <div id="output" class="result-text"></div>
            </div>
        </div>

        <div class="keyboard-container show" id="keyboardContainer">
            <div class="kb-tabs">
                <button class="kb-tab-btn active" data-target="page-abc">ABC</button>
                <button class="kb-tab-btn" data-target="page-special">Special</button>
                <button class="kb-tab-btn" data-target="page-num">123 & Sym</button>
                <button class="kb-tab-btn" data-target="page-extra">Ext</button>
            </div>

            <div class="kb-pages">
                <div class="kb-page active" id="page-abc">
                    <button class="key-btn" onclick="ins('q')">q</button>
                    <button class="key-btn" onclick="ins('w')">w</button>
                    <button class="key-btn" onclick="ins('e')">e</button>
                    <button class="key-btn" onclick="ins('r')">r</button>
                    <button class="key-btn" onclick="ins('t')">t</button>
                    <button class="key-btn" onclick="ins('y')">y</button>
                    <button class="key-btn" onclick="ins('u')">u</button>
                    <button class="key-btn" onclick="ins('i')">i</button>
                    <button class="key-btn" onclick="ins('o')">o</button>
                    <button class="key-btn" onclick="ins('p')">p</button>
                    
                    <div class="key-spacer"></div>
                    <button class="key-btn" onclick="ins('a')">a</button>
                    <button class="key-btn" onclick="ins('s')">s</button>
                    <button class="key-btn" onclick="ins('d')">d</button>
                    <button class="key-btn" onclick="ins('f')">f</button>
                    <button class="key-btn" onclick="ins('g')">g</button>
                    <button class="key-btn" onclick="ins('h')">h</button>
                    <button class="key-btn" onclick="ins('j')">j</button>
                    <button class="key-btn" onclick="ins('k')">k</button>
                    <button class="key-btn" onclick="ins('l')">l</button>
                    
                    <div class="key-spacer"></div>
                    <button class="key-btn" onclick="ins('z')">z</button>
                    <button class="key-btn" onclick="ins('x')">x</button>
                    <button class="key-btn" onclick="ins('c')">c</button>
                    <button class="key-btn" onclick="ins('v')">v</button>
                    <button class="key-btn" onclick="ins('b')">b</button>
                    <button class="key-btn" onclick="ins('n')">n</button>
                    <button class="key-btn" onclick="ins('m')">m</button>
                    <button class="key-btn key-sep" onclick="ins('·')" title="ตัวคั่นคำ">Sep</button>
                    <button class="key-btn" onclick="ins('.')">.</button>
                    
                    <div class="key-spacer"></div>
                    <button class="key-btn key-space" onclick="ins(' ')">space</button>
                    <button class="key-btn key-action btn-del">⌫</button>
                    <button class="key-btn key-action key-enter" onclick="ins('\n')">Enter</button>
                </div>

                <div class="kb-page" id="page-special">
                    <button class="key-btn" onclick="ins('ā')">ā</button>
                    <button class="key-btn" onclick="ins('ī')">ī</button>
                    <button class="key-btn" onclick="ins('ū')">ū</button>
                    <button class="key-btn" onclick="ins('e̤')">e̤</button>
                    <button class="key-btn" onclick="ins('o̤')">o̤</button>
                    <button class="key-btn" onclick="ins('ä')">ä</button>
                    <button class="key-btn" onclick="ins('ü')">ü</button>
                    <button class="key-btn" onclick="ins('å')">å</button>
                    <button class="key-btn" onclick="ins('ǖ')">ǖ</button>
                    

                    <button class="key-btn" onclick="ins('i̤')">i̤</button>
                    <button class="key-btn" onclick="ins('ī̤')">ī̤</button>
                    <button class="key-btn" onclick="ins('ɲ')">ɲ</button>
                    <button class="key-btn" onclick="ins('ɳ')">ɳ</button>
                    <button class="key-btn" onclick="ins('ē̤')">ē̤</button>
                    <button class="key-btn" onclick="ins('ṭ')">ṭ</button>
                    <button class="key-btn" onclick="ins('ḍ')">ḍ</button>
                    <button class="key-btn" onclick="ins('ṇ')">ṇ</button>
                    <button class="key-btn" onclick="ins('ḷ')">ḷ</button>
                    <button class="key-btn" onclick="ins('ṃ')">ṃ</button>

                    <button class="key-btn key-tone" onclick="ins('́')"><span>◌</span><b>́</b></button>
                    <button class="key-btn key-tone" onclick="ins('̋')"><span>◌</span><b>̋</b></button>
                    <button class="key-btn key-tone" onclick="ins('̌')"><span>◌</span><b>̌</b></button>
                    <button class="key-btn key-tone" onclick="ins('̽')"><span>◌</span><b>̽</b></button>
                    <button class="key-btn key-tone" onclick="ins('̃')"><span>◌</span><b>̃</b></button>
                    <button class="key-btn key-tone" onclick="ins('̂')"><span>◌</span><b>̂</b></button>
                    
                    <button class="key-btn key-sep" onclick="ins('·')">Sep</button>
                    <button class="key-btn" onclick="ins(',')">,</button>

                    <div class="key-spacer"></div>
                    <button class="key-btn key-space" onclick="ins(' ')">space</button>
                    <button class="key-btn key-action btn-del">⌫</button>
                    <button class="key-btn key-action key-enter" onclick="ins('\n')">Enter</button>
                </div>

                <div class="kb-page" id="page-num">
                    <button class="key-btn key-num" onclick="ins('1')">1</button>
                    <button class="key-btn key-num" onclick="ins('2')">2</button>
                    <button class="key-btn key-num" onclick="ins('3')">3</button>
                    <button class="key-btn key-num" onclick="ins('4')">4</button>
                    <button class="key-btn key-num" onclick="ins('5')">5</button>
                    <button class="key-btn key-num" onclick="ins('6')">6</button>
                    <button class="key-btn key-num" onclick="ins('7')">7</button>
                    <button class="key-btn key-num" onclick="ins('8')">8</button>
                    <button class="key-btn key-num" onclick="ins('9')">9</button>
                    <button class="key-btn key-num" onclick="ins('0')">0</button>
                    
                    <button class="key-btn key-sym" onclick="ins('@')">@</button>
                    <button class="key-btn key-sym" onclick="ins('#')">#</button>
                    <button class="key-btn key-sym" onclick="ins('฿')">฿</button>
                    <button class="key-btn key-sym" onclick="ins('&')">&</button>
                    <button class="key-btn key-sym" onclick="ins('_')">_</button>
                    <button class="key-btn key-sym" onclick="ins('-')">-</button>
                    <button class="key-btn key-sym" onclick="ins('+')">+</button>
                    <button class="key-btn key-sym" onclick="ins('(')">(</button>
                    <button class="key-btn key-sym" onclick="ins(')')">)</button>
                    <button class="key-btn key-sym" onclick="ins('/')">/</button>

                    <button class="key-btn key-sym" onclick="ins('*')">*</button>
                    <button class="key-btn key-sym" onclick="ins('\"')">"</button>
                    <button class="key-btn key-sym" onclick="ins('\'')">'</button>
                    <button class="key-btn key-sym" onclick="ins(':')">:</button>
                    <button class="key-btn key-sym" onclick="ins(';')">;</button>
                    <button class="key-btn key-sym" onclick="ins('!')">!</button>
                    <button class="key-btn key-sym" onclick="ins('?')">?</button>
                    <button class="key-btn key-sym" onclick="ins('÷')">÷</button>
                    <button class="key-btn key-sym" onclick="ins('%')">%</button>
                    <button class="key-btn key-sym" onclick="ins('×')">×</button>

                    <div class="key-spacer"></div>
                    <button class="key-btn key-space" onclick="ins(' ')">space</button>
                    <button class="key-btn key-action btn-del">⌫</button>
                    <button class="key-btn key-action key-enter" onclick="ins('\n')">Enter</button>
                </div>

                <div class="kb-page" id="page-extra">
                    <button class="key-btn" onclick="ins('z̥')">z̥</button>
                    <button class="key-btn" onclick="ins('d̥')">d̥</button>
                    <button class="key-btn" onclick="ins('t̥')">t̥</button>
                    <button class="key-btn" onclick="ins('g̥h')">g̥h</button>
                    <button class="key-btn" onclick="ins('j̥')">j̥</button>
                    <button class="key-btn" onclick="ins('k̥h')">k̥h</button>
                    <button class="key-btn" onclick="ins('b̥')">b̥</button>
                    <button class="key-btn" onclick="ins('b̥h')">b̥h</button>
                    <button class="key-btn" onclick="ins('p̥h')">p̥h</button>
                    <button class="key-btn" onclick="ins('p̥')">p̥</button>
                    
                    <button class="key-btn" onclick="ins('t̥h')">t̥h</button>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>
                    <div class="key-spacer"></div>

                    <div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div>
                    <div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div><div class="key-spacer"></div>

                    <div class="key-spacer"></div>
                    <button class="key-btn key-space" onclick="ins(' ')">space</button>
                    <button class="key-btn key-action btn-del">⌫</button>
                    <button class="key-btn key-action key-enter" onclick="ins('\n')">Enter</button>
                </div>
            </div>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="manual-content">
                <h2>📖 คู่มือการใช้งาน (User Manual)</h2>
                <p>ยินดีต้อนรับสู่ <strong>Thai-Latin Notepad</strong> เครื่องมือแปลงภาษาไทย-ละตินที่แม่นยำที่สุด</p>

                <h3>1. การเลือกโหมด (Modes)</h3>
                <ul>
                    <li><strong>ไทย ⮕ Lat:</strong> พิมพ์ไทยปกติ ระบบจะแปลงเป็นอักษรละติน</li>
                    <li><strong>Lat ⮕ ไทย:</strong> พิมพ์ด้วยแป้นพิมพ์จำลองด้านล่าง ระบบจะแปลงกลับเป็นไทย</li>
                </ul>

                <h3>2. แป้นพิมพ์จำลอง (Virtual Keyboard)</h3>
                <p>เมื่อเลือกโหมด <strong>Lat ⮕ ไทย</strong> จะมี 3 แถบให้เลือก:</p>
                <ul>
                    <li><strong>ABC:</strong> พยัญชนะพื้นฐาน (k=ก, m=ม, n=น)</li>
                    <li><strong>Special:</strong> รวมสระพิเศษและวรรณยุกต์ (สำคัญมาก!)</li>
                    <li><strong>123 & Sym:</strong> ตัวเลขและเครื่องหมายต่างๆ</li>
                </ul>

                <h3>3. ตารางปุ่มพิเศษ (Key Mappings)</h3>
                <p><strong>วรรณยุกต์ (Tones):</strong> *พิมพ์พยัญชนะก่อน แล้วตามด้วยวรรณยุกต์*</p>
                <table class="key-table">
                    <tr><th>ปุ่ม</th><th>ความหมาย</th><th>ตัวอย่าง</th></tr>
                    <tr><td>́</td><td>ไม้เอก ( ่ )</td><td>k + ́ = ก่</td></tr>
                    <tr><td>̋</td><td>ไม้โท ( ้ )</td><td>k + ̋ = ก้</td></tr>
                    <tr><td>̌</td><td>ไม้ตรี ( ๊ )</td><td>k + ̌ = ก๊</td></tr>
                    <tr><td>̽</td><td>ไม้จัตวา ( ๋ )</td><td>k + ̽ = ก๋</td></tr>
                    <tr><td>̃</td><td>การันต์ ( ์ )</td><td>s + ̃ = ส์</td></tr>
                    <tr><td>̂</td><td>ไม้ไต่คู้ ( ็ )</td><td>k + ̂ = ก็</td></tr>
                </table>

                <br>
                <p><strong>สระพิเศษ (Vowels):</strong></p>
                <table class="key-table">
                    <tr><th>ปุ่ม</th><th>ความหมาย</th><th>ปุ่ม</th><th>ความหมาย</th></tr>
                    <tr><td>ā</td><td>สระอา</td><td>i̤</td><td>ไม้ม้วน (ใ)</td></tr>
                    <tr><td>ī</td><td>สระอี</td><td>ī̤</td><td>ไม้มลาย (ไ)</td></tr>
                    <tr><td>ū</td><td>สระอู</td><td>å</td><td>สระอำ</td></tr>
                    <tr><td>ü</td><td>สระอึ</td><td>e̤/ē̤</td><td>สระเอ/แอ</td></tr>
                    <tr><td>ǖ</td><td>สระอือ</td><td>o̤</td><td>สระโอ</td></tr>
                </table>

                <h3>4. ปุ่ม Sep (ตัวคั่นคำ)</h3>
                <p>ปุ่ม <span class="key-badge">Sep</span> หรือจุด <span class="key-badge">·</span> มีไว้เพื่อแก้ความกำกวม</p>
                <ul>
                    <li><strong>ปัญหา:</strong> d=ท, h=ห แต่ dh=ธ</li>
                    <li><strong>วิธีแก้:</strong> ถ้าจะพิมพ์ "ทหาร" (ท+ห) ต้องกดคั่นกลาง</li>
                    <li>พิมพ์: <code>d</code> <code>·</code> <code>h</code> <code>ā</code> <code>r</code> ⮕ <strong>ทหาร</strong></li>
                    <li>พิมพ์: <code>d</code> <code>h</code> <code>ā</code> <code>r</code> ⮕ <strong>ธาร</strong></li>
                </ul>

                <h3>5. ทิปส์เพิ่มเติม</h3>
                <ul>
                    <li><strong>Checkbox "แสดงจุดคั่น":</strong> ติ๊กออกได้หากต้องการผลลัพธ์ที่สะอาดตา (เช่น <code>d·h·ā·r</code> vs <code>dhār</code>)</li>
                    <li><strong>ปุ่มลบ (⌫):</strong> กดค้างเพื่อลบแบบรัวๆ</li>
                    <li><strong>ปุ่ม Sys KB:</strong> ใช้สลับไปพิมพ์ด้วยคีย์บอร์ดของเครื่องแทน</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Data Mappings
        const rawData = [
            ['ำ', 'å'], ['า', 'ā'], ['ะ', 'a'],
            ['ี', 'ī'], ['ิ', 'i'], ['ู', 'ū'], ['ุ', 'u'],
            ['เ', 'e̤'], ['แ', 'ē̤'], ['โ', 'o̤'], ['ไ', 'ī̤'], ['ใ', 'i̤'],
            ['ั', 'ä'], ['็', '̂'], ['ึ', 'ü'],['ื', 'ǖ'],
            ['่', '́'], ['้', '̋'], ['๊', '̌'], ['๋', '̽'],
            ['์', '̃'], ['ๆ', 'ๆ'],
            ['กร', 'kr'], ['กล', 'kl'], ['กว', 'kv'], ['ขร', 'khr'], ['ขล', 'khl'], ['ขว', 'khv'],
            ['คร', 'gr'], ['คล', 'gl'], ['คว', 'gv'], ['งง', 'ɲɲ'],
            ['จร', 'cr'], ['จล', 'cl'], ['ฉร', 'chr'],
            ['ตร', 'tr'], ['ตล', 'tl'], ['ถร', 'thr'], ['ทร', 'dr'], ['นน', 'nn'],
            ['ปร', 'pr'], ['ปล', 'pl'], ['ผล', 'phl'], ['พร', 'br'], ['พล', 'bl'],
            
            ['ก', 'k'], ['ข', 'kh'], ['ค', 'g'],['ฃ', 'k̥h'], ['ฅ', 'g̥h'], ['ฆ', 'gh'], ['ง', 'ɲ'],
            ['จ', 'c'], ['ฉ', 'ch'], ['ช', 'j'], ['ฌ', 'jh'], ['ญ', 'ɳ'],
            ['ฏ', 'ṭ'], ['ฐ', 'ṭh'], ['ฑ', 'ḍ'], ['ฒ', 'ḍh'], ['ณ', 'ṇ'], ['ฎ', 'd̥'],
            ['ต', 't'], ['ถ', 'th'], ['ท', 'd'], ['ธ', 'dh'], ['น', 'n'],
            ['ป', 'p'], ['ผ', 'ph'], ['พ', 'b'], ['ภ', 'bh'], ['ม', 'm'],
            ['ย', 'y'], ['ร', 'r'], ['ล', 'l'], ['ว', 'v'],
            ['ส', 's'], ['ห', 'h'], ['ฬ', 'ḷ'], ['อ', 'x'],
            ['ํ', 'ṃ'], ['ฯ', 'ฯ'],
            ['ศ', 'z̥'], ['ษ', 'z'], ['ฮ', 'xh'],
            ['บ', 'p̥'], ['ฟ', 'b̥'], ['ฝ', 'p̥h'],
            ['ฤ', 't̥h'], ['ฦ', 'b̥h'],['ด', 't̥'],['ซ', 'j̥'],
            
            ['', '·'] 
        ];

        // Normalization: NFD for Input Matching, NFC for Output
        const conversionsToLatin = rawData.map(pair => 
            [pair[0].normalize('NFC'), pair[1].normalize('NFC')]
        ).sort((a, b) => b[0].length - a[0].length);

        const conversionsToThai = rawData.map(pair => 
            [pair[0].normalize('NFC'), pair[1].normalize('NFD')]
        ).sort((a, b) => b[1].length - a[1].length);

        // DOM Elements
        const inputEl = document.getElementById('input');
        const outputEl = document.getElementById('output');
        const resultLabel = document.getElementById('resultLabel');
        const radios = document.getElementsByName('mode');
        const clearBtn = document.getElementById('clearBtn');
        const toggleKbBtn = document.getElementById('toggleKbBtn');
        const keyboardContainer = document.getElementById('keyboardContainer');
        const tabBtns = document.querySelectorAll('.kb-tab-btn');
        const pages = document.querySelectorAll('.kb-page');
        const systemKbToggle = document.getElementById('systemKbToggle');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const showSepCheckbox = document.getElementById('showSep');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeModal = document.querySelector('.close-modal');

        // Modal Logic
        helpBtn.addEventListener('click', () => helpModal.classList.add('show'));
        closeModal.addEventListener('click', () => helpModal.classList.remove('show'));
        helpModal.addEventListener('click', (e) => { if(e.target === helpModal) helpModal.classList.remove('show'); });

        // Fullscreen Logic
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => console.error(err));
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        });

        // Tab Switching
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                tabBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(this.dataset.target).classList.add('active');
            });
        });

        // Insert Character
        window.ins = function(char) {
            const start = inputEl.selectionStart;
            const end = inputEl.selectionEnd;
            const text = inputEl.value;
            inputEl.value = text.substring(0, start) + char + text.substring(end);
            inputEl.selectionStart = inputEl.selectionEnd = start + char.length;
            inputEl.focus(); 
            processConversion();
        };

        // Long Press Delete
        let deleteTimer = null;
        const delButtons = document.querySelectorAll('.btn-del');

        function performDelete() {
            const start = inputEl.selectionStart;
            const end = inputEl.selectionEnd;
            const val = inputEl.value;
            if (start === end) {
                if (start > 0) {
                    inputEl.value = val.substring(0, start - 1) + val.substring(end);
                    inputEl.selectionStart = inputEl.selectionEnd = start - 1;
                }
            } else {
                inputEl.value = val.substring(0, start) + val.substring(end);
                inputEl.selectionStart = inputEl.selectionEnd = start;
            }
            processConversion();
        }

        function startDeleting(e) {
            if (e.cancelable) e.preventDefault();
            performDelete();
            deleteTimer = setTimeout(() => { deleteTimer = setInterval(performDelete, 80); }, 500);
        }

        function stopDeleting() {
            if (deleteTimer) { clearTimeout(deleteTimer); clearInterval(deleteTimer); deleteTimer = null; }
            inputEl.focus();
        }

        delButtons.forEach(btn => {
            btn.addEventListener('mousedown', startDeleting);
            btn.addEventListener('mouseup', stopDeleting);
            btn.addEventListener('mouseleave', stopDeleting);
            btn.addEventListener('touchstart', startDeleting, { passive: false });
            btn.addEventListener('touchend', stopDeleting);
            btn.addEventListener('touchcancel', stopDeleting);
        });

        window.toggleKb = function() {
            const isShow = keyboardContainer.classList.contains('show');
            if (isShow) {
                keyboardContainer.classList.remove('show');
                toggleKbBtn.classList.remove('active');
            } else {
                keyboardContainer.classList.add('show');
                toggleKbBtn.classList.add('active');
            }
        };
        toggleKbBtn.addEventListener('click', window.toggleKb);

        systemKbToggle.addEventListener('click', function() {
            const currentMode = inputEl.getAttribute('inputmode');
            if (currentMode === 'none') {
                inputEl.setAttribute('inputmode', 'text');
                this.textContent = 'Sys KB: ON';
                this.classList.add('active');
                inputEl.focus();
            } else {
                inputEl.setAttribute('inputmode', 'none');
                this.textContent = 'Sys KB: OFF';
                this.classList.remove('active');
                inputEl.blur();
                setTimeout(() => inputEl.focus(), 50);
            }
        });

        function processConversion() {
            let rawInput = inputEl.value;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const showSep = showSepCheckbox.checked;

            clearBtn.style.visibility = rawInput.length > 0 ? 'visible' : 'hidden';

            if (!rawInput.trim()) {
                outputEl.textContent = "";
                return;
            }

            let result = "";

            if (mode === 'toLatin') {
                result = rawInput.normalize('NFC');
                conversionsToLatin.forEach(pair => {
                    result = result.split(pair[0]).join(pair[1]);
                });
                result = result.replace(/·(?=[\u0300-\u036f\u1dc0-\u1dff\u20d0-\u20ff])/g, '');
                if (!showSep) result = result.replace(/·/g, '');
            } else {
                result = rawInput.normalize('NFD');
                conversionsToThai.forEach(pair => {
                    result = result.split(pair[1]).join(pair[0]);
                });
            }

            outputEl.textContent = result.normalize('NFC');
        }

        inputEl.addEventListener('input', processConversion);
        clearBtn.addEventListener('click', () => { inputEl.value = ''; inputEl.focus(); processConversion(); });
        showSepCheckbox.addEventListener('change', processConversion);

        radios.forEach(radio => {
            radio.addEventListener('change', function() {
                const mode = this.value;
                if (mode === 'toLatin') {
                    inputEl.placeholder = "พิมพ์ภาษาไทย...";
                    resultLabel.textContent = "Result (Latin)";
                    showSepCheckbox.parentElement.style.display = 'flex';
                } else {
                    inputEl.placeholder = "ใช้แป้นพิมพ์ด้านล่าง...";
                    resultLabel.textContent = "Result (Thai)";
                    showSepCheckbox.parentElement.style.display = 'none';
                    if (!keyboardContainer.classList.contains('show')) window.toggleKb();
                    tabBtns[0].click();
                }
                processConversion();
            });
        });
    </script>
</body>
</html>